name: Contributors List
description: | 
  Writes the contributors.json file to be read by the Unity project.
  Please note the API shortcomings: https://docs.github.com/en/rest/repos/repos#list-repository-contributors
  If we have more than 100 contributors, we need to page the result.
  If we have more than 500 contributors, not all will be shown anymore.
inputs:
  github-token:
    required: true
    description: GitHub Token
  project-path:
    required: true
    description: Path that points to the Unity project folder
  
runs:
  using: 'composite'
  steps:
    - name: Install jq
      run: sudo apt-get install jq
      shell: sh
    - name: Get Contributors from API
      id: variables
      env:
        GH_TOKEN: ${{ inputs.github-token }}
      run: |
        echo "::set-output name=contributors::$(gh api /repos/BoundfoxStudios/community-project/contributors | jq --compact-output '[.[] | { user: .login, url: .url, contributions: .contributions }]')"
      shell: sh
    - name: Write Build Manifest to JSON file
      uses: DamianReeves/write-file-action@master
      with:
        path: ${{ inputs.project-path }}/Assets/_Game/Resources/contributors.json
        write-mode: overwrite
        contents: ${{ steps.variables.outputs.contributors }}
    - uses: actions/upload-artifact@v2
      with:
        name: contributors
        path: ${{ inputs.project-path }}/Assets/_Game/Resources/contributors.json
        if-no-files-found: error